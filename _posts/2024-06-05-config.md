---
title: 游댢 Configuracion post instalacion
author: mgrl39
date: 2024-06-05
category: Jekyll
layout: post
---

### 1. Acceso al Sistema

Primero, debemos introducir el usuario y contrase침a que hemos creado. En este caso, el usuario es `meghribe` y la contrase침a es `42Password-`.

![Imagen 151](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_151.png) 

---

### 2. Instalaci칩n de `sudo` y Configuraci칩n de Usuarios y Grupos 游녻

1. Para instalar `sudo`, primero debemos estar en el usuario **root**. Ejecutamos `su` en el terminal e introducimos la contrase침a, en este caso `42Barcelona-`. Luego, instalamos `sudo` con el siguiente comando:

    ```bash
    apt update -y && apt install sudo -y && sudo reboot
    ```

    ![Imagen 153](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_153.png) 

2. Despu칠s del reinicio, volvemos a entrar con nuestro usuario (`meghribe`) y accedemos a `root` con `su` y la contrase침a.

3. Creamos un nuevo grupo llamado `user42`:

    ```bash
    sudo addgroup user42
    ```

    **GID** es el identificador del grupo, que es una abreviatura de Group ID. Para verificar si el grupo se ha creado correctamente, podemos usar el comando `getent group nombre_grupo` o `cat /etc/group`.

4. A침adimos nuestro usuario al grupo `user42` y a `sudo`:

    ```bash
    sudo adduser meghribe user42
    sudo adduser meghribe sudo
    ```

    Para verificar que se ha hecho correctamente:

    ```bash
    getent group sudo
    getent group user42
    ```

    ![Imagen 155](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_155.png)  

---

### 3. Instalaci칩n y Configuraci칩n de SSH

1. Instalamos el protocolo SSH:

    ```bash
    sudo apt install openssh-server -y
    ```

    ![Imagen 156](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_156.png) 

2. Verificamos el estado del servicio SSH:

    ```bash
    sudo service ssh status
    ```

    ![Imagen 157](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_157.png) 

3. Instalamos el editor de texto `vim`:

    ```bash
    sudo apt install vim -y
    ```

    ![Imagen 159](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_159.png)  

4. Configuramos el protocolo SSH:

    - Editamos el archivo `/etc/ssh/sshd_config` para definir el puerto 4242 y desactivar el login de root. Verificamos los valores actuales con:

      ```bash
      cat /etc/ssh/sshd_config | grep Port
      cat /etc/ssh/sshd_config | grep PermitRootLogin
      ```

      Editamos el archivo con `vim`:

      ```bash
      vim /etc/ssh/sshd_config
      ```

      Descomentamos `#Port 22` y cambiamos el n칰mero a `4242`, y descomentamos `#PermitRootLogin prohibit-password` y lo cambiamos a `PermitRootLogin no`.

      ![Imagen 160](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_160.png)  
      ![Imagen 161](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_161.png)  
      ![Imagen 162](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_162.png) 

    - Ahora, editamos el archivo `/etc/ssh/ssh_config` para definir el mismo puerto:

      ```bash
      vim /etc/ssh/ssh_config
      ```

      Cambiamos el puerto a `4242`.

      ![Imagen 163](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_163.png)  
      ![Imagen 164](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_164.png)  
      ![Imagen 165](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_165.png) 

    - Reiniciamos el servicio SSH:

      ```bash
      sudo service ssh restart
      ```

    - Instalamos y configuramos el firewall `ufw`:

      ```bash
      sudo apt install ufw -y
      sudo ufw enable
      sudo ufw status
      sudo ufw allow 4242
      sudo ufw status
      ip -c a
      ```

      ![Imagen 168](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_168.png)  
      ![Imagen 170](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_170.png) 

    - Finalmente, probamos la conexi칩n SSH:

      ```bash
      ssh LA_IP_DE_LA_MAQUINA_VIRTUAL -p 4242
      ```

      ![Imagen 172](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_172.png) 

---

### 4. Configuraci칩n Adicional de `sudo`

1. Configuramos `sudo` para registrar intentos de acceso y otras configuraciones:

    ```bash
    sudo su
    touch /etc/sudoers.d/sudo_config
    mkdir /var/log/sudo
    ```

    Editamos el archivo `/etc/sudoers.d/sudo_config`:

    ```bash
    Defaults  passwd_tries=3
    Defaults  badpass_message="Mensaje de error personalizado"
    Defaults  logfile="/var/log/sudo/sudo_config"
    Defaults  log_input, log_output
    Defaults  iolog_dir="/var/log/sudo"
    Defaults  requiretty
    Defaults  secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"
    ```

    ![Imagen 174](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_174.png)  
    ![Imagen 175](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_175.png) 

---

### 5. Configuraci칩n de Pol칤ticas de Contrase침a

1. Editamos el archivo `/etc/login.defs` para definir pol칤ticas de contrase침as:

    ```bash
    vim /etc/login.defs
    ```

    Ajustamos los valores para la expiraci칩n y advertencia de contrase침as:

    ```bash
    PASS_MAX_DAYS  30
    PASS_MIN_DAYS  2
    PASS_WARN_AGE  7
    ```

    ![Imagen 176](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_176.png)  
    ![Imagen 178](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_178.png) 

2. Instalamos el m칩dulo `libpam-pwquality` para mejorar la calidad de las contrase침as:

    ```bash
    sudo apt install libpam-pwquality -y
    ```

    ![Imagen 179](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_179.png) 

3. Editamos el archivo `/etc/pam.d/common-password` para establecer pol칤ticas de calidad de contrase침as:

    ```bash
    vim /etc/pam.d/common-password
    ```

    Cambiamos la configuraci칩n a:

    ```bash
    minlen=10 ucredit=-1 dcredit=-1 lcredit=-1 maxrepeat=3 reject_username difok=7 enforce_for_root
    ```

    ![Imagen 180](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_180.png)  
    ![Imagen 182](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_182.png)  
    ![Imagen 184](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_184.png) 

4. Revisamos la configuraci칩n de expiraci칩n de contrase침as para el usuario root:

    ```bash
    sudo chage -l root
    sudo chage -m 2 root
    sudo chage -M 30 root
    sudo chage -l root
    ```

    ![Imagen 186](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_186.png) 

---

### 6. Informaci칩n del Sistema

Finalmente, obtenemos informaci칩n sobre el sistema:

```bash
uname -a
```

![Imagen 187](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_187.png) 
