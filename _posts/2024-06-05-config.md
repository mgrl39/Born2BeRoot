---
title: 游댢 Configuracion post instalacion
author: mgrl39
date: 2024-06-05
category: Jekyll
layout: post
---

1. Debemos introducir el usuario y contrase침a que hemos creado. En mi caso el usuario es `meghribe` y la contrase침a `42Password-`.
![Imagen 151](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_151.png) 
## Instalaci칩n de sudo y configuraci칩n de usuarios y grupos 游녻
2. Para la instalaci칩n de sudo primero debemos estar en el usuario **root**, para ello pondremos `su` en el terminal e introduciremos la contrase침a, en mi caso es `42Barcelona-`. Una vez hemos accedido al usuario root, debemos poner el comando `apt` install sudo para as칤 instalar los paquetes necesarios. Despues de actualizar los paquetes e instalar sudo reiniciareemos:
```bash
apt update -y && apt install sudo -y && sudo reboot
```
![Imagen 153](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_153.png) 
3. Despues de reiniciar, volveremos a entrar a nuestro usuario (como hicimos en el punto 1)
4. Seguidamente, entramos a `root` con `su` y escribimos la contrase침a.
5. Siguiendo en el usuario root, crearemos un nuevo grupo llamado `user42`. Para crearlo debemos hacer `sudo addgroup user42`.
```bash
sudo addgroup user42
```
**GID --> Es el identificador de grupo, es una abreviatura de Group ID.**

**Se ha creado correctamente el grupo?** S칤, ya que no ha habido ning칰n mensaje de error, aun as칤 podemos comprobar si se ha creado con el comando `getent group nombre_grupo` o tambi칠n podemos hacer `cat /etc/group`` y podremos ver todos los grupos y los usuarios que hay dentro de ellos.

Seguidamente, anadimos nuestro usuario al grupo `user42` y  `sudo`, para realizar eso, ejecutamos `sudo adduser usuario user42`.  Seguidaamente, `sudo adduser usuario sudo`. Para revisar que esta colocado todo bien `getent group sudo` y `getent group user42`.
```bash
sudo addgroup user42 && sudo adduser meghribe user42 && sudo adduser meghribe sudo
```
```bash
getent group sudo && getent group user42
```
![Imagen 155](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_155.png)  

3. Seguidamente, instalaremos el protocolo SSH
```bash
sudo apt install openssh-server -y
```
![Imagen 156](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_156.png)
```bash
sudo service ssh status
```
![Imagen 157](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_157.png)
```bash
sudo apt install vim -y
```
![Imagen 159](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_159.png)  
4. Configuracion del protocolo SSH
- Vamos a hacer cambios en el archivo `/etc/ssh/sshd_config` y definir el puerto 4242 y no permitir el login de root. Podemos ver que valores tienen ahora con `cat /etc/ssh/sshd_config | grep Port` y `cat /etc/ssh/sshd_config | grep PermitRootLogin`.

![Imagen 160](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_160.png)  
Editamos el archivo con el comando: `vim /etc/ssh/sshd_config`, vuestro archivo se vera asi:
```bash
vim /etc/ssh/sshd_config
```
![Imagen 161](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_161.png)  

Ahora, descomentaremos el `#Port 22` pero cambiamos el numero a 4242, es decir, quedara `Port 4242`. Ahora descomentamos `#PermitRootLogin prohibit-password` lo descomentamos y ponemos `#PermitRootLogin no`.

![Imagen 162](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_162.png) 
Guardamos el archivo anterior con los nuevos cambios :)

Ahora editaremos otro archivo, `cat /etc/ssh/ssh_config` (es otro archivo, solo que tienen nombre muy parecido). Vamos a modificar el puerto de este archivo: `cat /etc/ssh/ssh_config | grep Port`
![Imagen 163](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_163.png)
Utilizamos `vim /etc/ssh/ssh_config` para modificar el archivo.
```bash
vim /etc/ssh/ssh_config
```
![Imagen 164](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_164.png)
Este es el archivo modificado, lo unico cambiado es el Puerto, ahora es `Port 4242`. Ahora, guardamos el aarchivo :)
![Imagen 165](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_165.png)  
```bash
sudo service ssh restart && sudo service ssh restart
```
![Imagen 167](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_167.png)
```bash
sudo apt install ufw -y
```
![Imagen 168](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_168.png)
```bash
sudo ufw enable && sudo ufw status && sudo ufw allow 4242 && sudo ufw status && ip -c a
``` 
![Imagen 170](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_170.png) 
```bash
ssh LA_IP_DE_LA_MAQUINA_VIRTUAL -p 4242
``` 
![Imagen 172](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_172.png) 
```bash
sudo su
``` 
```bash
touch /etc/sudoers.d/sudo_config
mkdir /var/log/sudo
```
![Imagen 174](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_174.png)
```bash
Defaults  passwd_tries=3
Defaults  badpass_message="Mensaje de error personalizado"
Defaults  logfile="/var/log/sudo/sudo_config"
Defaults  log_input, log_output
Defaults  iolog_dir="/var/log/sudo"
Defaults  requiretty
Defaults  secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"
```
![Imagen 175](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_175.png)
```bash
vim /etc/login.defs
```
![Imagen 176](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_176.png)  
![Imagen 178](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_178.png) 
```bash
sudo apt install libpam-pwquality -y
```
![Imagen 179](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_179.png)
```bash
vim /etc/pam.d/common-password
```
![Imagen 180](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_180.png)  
De esta manera es el archivo `common-password`. Sin modificar nada te aparecera asi:
![Imagen 182](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_182.png)  
Si ves la primera linea, la que ponia `password	requisite pam_pwquality.so retry=3 minlen=10...`
Pondremos lo siguiente:
```
minlen=10 ucredit=-1 dcredit=-1 lcredit=-1 maxrepeat=3 reject_username difok=7 enforce_for_root
```
![Imagen 184](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_184.png)  
```bash
sudo chage -l root && sudo chage -m 2 root && sudo chage -M 30 root && sudo chage -l root
```
![Imagen 186](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_186.png)
```bash
uname -a
```
![Imagen 187](https://raw.githubusercontent.com/mgrl39/Born2BeRoot/main/steps/b2br_img_187.png)  
